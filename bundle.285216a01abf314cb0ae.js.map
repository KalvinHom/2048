{"version":3,"sources":["webpack:///./src/board.js","webpack:///./src/script.js","webpack:///./src/game.js","webpack:///./src/canvas.js"],"names":["game","constructor","this","setDefaults","board","Array","fill","map","actions","x","action","canvas","document","querySelector","width","window","innerWidth","height","innerHeight","context","getContext","numTranslate","ready","beginTurn","newPiece","y","Math","floor","random","rand","console","log","moveLeft","validMove","nextVal","getNextValue","translate","moveRight","WIDTH","moveUp","getNextYValue","moveDown","HEIGHT","dir","style","draw","clearRect","actionOccurred","getElementsByClassName","transform","transitioning","base","$","each","addEventListener","handler","e","currentTarget","removeEventListener","type","completeTransitions","drawBoard","color","log2","content","innerHTML","isReady","startGame","lastRenderTime","Date","now","fired","event","preventDefault","key"],"mappings":"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","file":"bundle.285216a01abf314cb0ae.js","sourcesContent":["const WIDTH = 4;\r\nconst HEIGHT = 4;\r\nconst CELL_SIZE = 100;\r\n\r\nconst NEW_TILE = -1;\r\nconst MOVE = 1;\r\nconst MERGE = 2;\r\nclass Board {\r\n  constructor() {\r\n    this.board = Array(HEIGHT)\r\n      .fill()\r\n      .map(() => Array(WIDTH).fill(0));\r\n\r\n    this.actions = Array(HEIGHT)\r\n      .fill()\r\n      .map(() =>\r\n        Array(WIDTH)\r\n          .fill()\r\n          .map((x) => ({ action: 0 }))\r\n      );\r\n\r\n    this.canvas = document.querySelector(\"canvas.board\");\r\n    this.canvas.width = window.innerWidth;\r\n    this.canvas.height = window.innerHeight;\r\n    this.context = this.canvas.getContext(\"2d\");\r\n    this.numTranslate = 0;\r\n    this.ready = true;\r\n  }\r\n  beginTurn() {\r\n    this.ready = false;\r\n  }\r\n\r\n  newPiece() {\r\n    let x, y;\r\n    do {\r\n      x = Math.floor(Math.random() * WIDTH);\r\n      y = Math.floor(Math.random() * HEIGHT);\r\n    } while (this.board[y][x] != 0);\r\n\r\n    const rand = Math.floor(Math.random() * 10);\r\n    this.board[y][x] = rand == 0 ? 4 : 2;\r\n    this.actions[y][x].action = NEW_TILE;\r\n    console.log(`new piece at ${x}, ${y}`);\r\n  }\r\n\r\n  //TODO: combine left/right/up/down when not being lazy with copy paste\r\n  moveLeft() {\r\n    let validMove = false;\r\n    for (let y = 0; y < HEIGHT; y++) {\r\n      for (let x = 0; x < WIDTH; x++) {\r\n        const nextVal = this.getNextValue(x + 1, y, 1);\r\n\r\n        if (nextVal == -1) break;\r\n\r\n        if (this.board[y][x] == 0) {\r\n          validMove = true;\r\n          this.board[y][x] = this.board[y][nextVal];\r\n          this.board[y][nextVal] = 0;\r\n          this.actions[y][nextVal].action = MOVE;\r\n          this.actions[y][nextVal].translate = [x - nextVal, 0];\r\n          x--;\r\n        } else if (this.board[y][x] == this.board[y][nextVal]) {\r\n          validMove = true;\r\n\r\n          this.board[y][x] *= 2;\r\n          this.board[y][nextVal] = 0;\r\n          this.actions[y][nextVal].action = MERGE;\r\n          this.actions[y][nextVal].translate = [x - nextVal, 0];\r\n        }\r\n      }\r\n    }\r\n    return validMove;\r\n  }\r\n\r\n  moveRight() {\r\n    let validMove = false;\r\n\r\n    for (let y = 0; y < HEIGHT; y++) {\r\n      for (let x = WIDTH - 1; x >= 0; x--) {\r\n        const nextVal = this.getNextValue(x - 1, y, -1);\r\n\r\n        if (nextVal == -1) break;\r\n\r\n        if (this.board[y][x] == 0) {\r\n          validMove = true;\r\n          this.board[y][x] = this.board[y][nextVal];\r\n          this.board[y][nextVal] = 0;\r\n          this.actions[y][nextVal].action = MOVE;\r\n          this.actions[y][nextVal].translate = [x - nextVal, 0];\r\n\r\n          x++;\r\n        } else if (this.board[y][x] == this.board[y][nextVal]) {\r\n          validMove = true;\r\n\r\n          this.board[y][x] *= 2;\r\n          this.board[y][nextVal] = 0;\r\n          this.actions[y][nextVal].action = MERGE;\r\n          this.actions[y][nextVal].translate = [x - nextVal, 0];\r\n        }\r\n      }\r\n    }\r\n    return validMove;\r\n  }\r\n\r\n  moveUp() {\r\n    let validMove = false;\r\n    for (let x = 0; x < WIDTH; x++) {\r\n      for (let y = 0; y < HEIGHT; y++) {\r\n        const nextVal = this.getNextYValue(x, y + 1, 1);\r\n\r\n        if (nextVal == -1) break;\r\n\r\n        if (this.board[y][x] == 0) {\r\n          validMove = true;\r\n          this.board[y][x] = this.board[nextVal][x];\r\n          this.board[nextVal][x] = 0;\r\n          this.actions[nextVal][x].action = MOVE;\r\n          this.actions[nextVal][x].translate = [0, y - nextVal];\r\n          y--;\r\n        } else if (this.board[y][x] == this.board[nextVal][x]) {\r\n          validMove = true;\r\n\r\n          this.board[y][x] *= 2;\r\n          this.board[nextVal][x] = 0;\r\n          this.actions[nextVal][x].action = MERGE;\r\n          this.actions[nextVal][x].translate = [0, y - nextVal];\r\n        }\r\n      }\r\n    }\r\n    return validMove;\r\n  }\r\n\r\n  moveDown() {\r\n    let validMove = false;\r\n\r\n    for (let x = 0; x < WIDTH; x++) {\r\n      for (let y = HEIGHT - 1; y >= 0; y--) {\r\n        const nextVal = this.getNextYValue(x, y - 1, -1);\r\n\r\n        if (nextVal == -1) break;\r\n\r\n        if (this.board[y][x] == 0) {\r\n          validMove = true;\r\n          this.board[y][x] = this.board[nextVal][x];\r\n          this.board[nextVal][x] = 0;\r\n          this.actions[nextVal][x].action = MOVE;\r\n          this.actions[nextVal][x].translate = [0, y - nextVal];\r\n          y++;\r\n        } else if (this.board[y][x] == this.board[nextVal][x]) {\r\n          validMove = true;\r\n\r\n          this.board[y][x] *= 2;\r\n          this.board[nextVal][x] = 0;\r\n          this.actions[nextVal][x].action = MERGE;\r\n          this.actions[nextVal][x].translate = [0, y - nextVal];\r\n        }\r\n      }\r\n    }\r\n    return validMove;\r\n  }\r\n\r\n  getNextValue(x, y, dir) {\r\n    while (x >= 0 && x < WIDTH) {\r\n      if (this.board[y][x] != 0) {\r\n        // const val = this.board[y][x];\r\n        // this.board[y][x] = 0;\r\n        return x;\r\n      }\r\n      x += dir;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  getNextYValue(x, y, dir) {\r\n    while (y >= 0 && y < HEIGHT) {\r\n      if (this.board[y][x] != 0) {\r\n        // const val = this.board[y][x];\r\n        // this.board[y][x] = 0;\r\n        return y;\r\n      }\r\n      y += dir;\r\n    }\r\n    return -1;\r\n  }\r\n\r\n  style(y, x) {\r\n    if (this.actions[y][x] == NEW_TILE) return \"new-tile\";\r\n\r\n    return \"normal\";\r\n  }\r\n  draw() {\r\n    this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n    console.log(\"beginning board draw\");\r\n    console.log(this.actions);\r\n    var actionOccurred = false;\r\n    for (let y = 0; y < HEIGHT; y++) {\r\n      for (let x = 0; x < WIDTH; x++) {\r\n        var content =\r\n          this.board[y][x] == 0\r\n            ? \"\"\r\n            : `<div class=\"tile ${this.style(y, x)}\">${this.board[y][x]}</div>`;\r\n\r\n        if (\r\n          this.actions[y][x].action != 0 &&\r\n          this.actions[y][x].action != NEW_TILE\r\n        ) {\r\n          actionOccurred = true;\r\n          document\r\n            .getElementsByClassName(\"grid-row\")\r\n            [y].getElementsByClassName(\"grid-cell\")\r\n            [x].getElementsByClassName(\r\n              \"tile\"\r\n            )[0].style.transform = `translate(${\r\n            this.actions[y][x].translate[0] * 106.25 +\r\n            15 * this.actions[y][x].translate[0]\r\n          }px, ${\r\n            this.actions[y][x].translate[1] * 106.25 +\r\n            15 * this.actions[y][x].translate[1]\r\n          }px)`;\r\n          this.numTranslate++;\r\n          this.transitioning = true;\r\n          console.log(`added numTranslate:${this.numTranslate}`);\r\n          var base = this;\r\n          $(\".normal\").each(function () {\r\n            this.addEventListener(\"transitionend\", function handler(e) {\r\n              console.log(e.currentTarget);\r\n              e.currentTarget.removeEventListener(e.type, handler);\r\n              base.completeTransitions();\r\n            });\r\n          });\r\n        }\r\n      }\r\n    }\r\n    if (!actionOccurred) {\r\n      this.drawBoard();\r\n      this.ready = true;\r\n    }\r\n  }\r\n\r\n  drawBoard() {\r\n    for (let y = 0; y < HEIGHT; y++) {\r\n      for (let x = 0; x < WIDTH; x++) {\r\n        var color =\r\n          this.board[y][x] == 0 ? \"\" : 255 - Math.log2(this.board[y][x]) * 10;\r\n        var content =\r\n          this.board[y][x] == 0\r\n            ? \"\"\r\n            : `<div class=\"tile ${this.style(\r\n                y,\r\n                x\r\n              )}\" style=\"background: rgb(255, ${color}, ${color})\r\n            \">${this.board[y][x]}</div>`;\r\n\r\n        document\r\n          .getElementsByClassName(\"grid-row\")\r\n          [y].getElementsByClassName(\"grid-cell\")[x].innerHTML = content;\r\n        this.actions[y][x].action = 0;\r\n      }\r\n    }\r\n  }\r\n\r\n  completeTransitions() {\r\n    if (this.transitioning) {\r\n      console.log(`complete transition`);\r\n      this.drawBoard();\r\n      this.ready = true;\r\n      this.transitioning = false;\r\n    }\r\n  }\r\n}\r\n\r\nexport default Board;\r\n","import Canvas from \"./canvas\";\r\nimport Board from \"./board\";\r\nimport \"./style.css\";\r\nimport Game from \"./game\";\r\n\r\nconst game = new Game();\r\n\r\ngame.startGame();\r\n// window.requestAnimationFrame(board.draw.bind(board));\r\n// board.newPiece();\r\n// board.newPiece();\r\n// window.requestAnimationFrame(board.draw.bind(board));\r\n\r\nlet fired = false;\r\nwindow.addEventListener(\"keydown\", function (event) {\r\n  event.preventDefault();\r\n  if (fired) return;\r\n\r\n  if (!game.isReady()) return;\r\n\r\n  fired = true;\r\n  event.key;\r\n  event.preventDefault();\r\n  switch (event.key) {\r\n    case \"ArrowLeft\":\r\n    case \"a\":\r\n      game.moveLeft();\r\n      break;\r\n    case \"ArrowRight\":\r\n    case \"d\":\r\n      game.moveRight();\r\n      break;\r\n\r\n    case \"ArrowUp\":\r\n    case \"w\":\r\n      game.moveUp();\r\n      break;\r\n    case \"ArrowDown\":\r\n    case \"s\":\r\n      game.moveDown();\r\n      break;\r\n\r\n    default:\r\n      fired = false;\r\n\r\n      return;\r\n  }\r\n  fired = false;\r\n});\r\n\r\n// window.addEventListener(\"keyup\", function (event) {\r\n//   switch (event.key) {\r\n//     case \"ArrowDown\":\r\n//     case \"s\":\r\n//       game.speedOff();\r\n//       break;\r\n//     default:\r\n//       return;\r\n//   }\r\n// });\r\n","import Board from \"./board\";\r\nimport Canvas from \"./canvas\";\r\n\r\nconst ALIVE = 0;\r\nconst GAMEOVER = 1;\r\n\r\nclass Game {\r\n  constructor() {\r\n    this.setDefaults();\r\n  }\r\n\r\n  setDefaults() {\r\n    this.board = new Board();\r\n    this.canvas = new Canvas();\r\n  }\r\n\r\n  isReady() {\r\n    return this.board.ready;\r\n  }\r\n  startGame() {\r\n    this.lastRenderTime = Date.now();\r\n    this.board.newPiece();\r\n    this.board.newPiece();\r\n    // this.board.draw();\r\n    this.board.drawBoard();\r\n  }\r\n\r\n  moveLeft() {\r\n    this.board.beginTurn();\r\n    if (this.board.moveLeft()) this.board.newPiece();\r\n    this.board.draw();\r\n  }\r\n\r\n  moveRight() {\r\n    this.board.beginTurn();\r\n    if (this.board.moveRight()) this.board.newPiece();\r\n    this.board.draw();\r\n  }\r\n\r\n  moveUp() {\r\n    this.board.beginTurn();\r\n    if (this.board.moveUp()) this.board.newPiece();\r\n    this.board.draw();\r\n  }\r\n\r\n  moveDown() {\r\n    this.board.beginTurn();\r\n    if (this.board.moveDown()) this.board.newPiece();\r\n    this.board.draw();\r\n  }\r\n}\r\n\r\nexport default Game;\r\n","import Board from \"./board\";\r\nimport { HIDDEN_ROWS } from \"./constants\";\r\n\r\n// this class focuses on how to draw elements\r\nclass Canvas {\r\n  constructor(board) {\r\n    // this.boardPosX = 28;\r\n    // this.boardPosY = 28;\r\n    // this.cellSize = 28;\r\n    // this.levelPosX = 450;\r\n    // this.levelPosY = 375;\r\n    // this.scorePosX = 450;\r\n    // this.scorePosY = 428;\r\n    // this.previewX = 400;\r\n    // this.previewY = 120;\r\n    // this.board = board;\r\n    // this.boarderColor = \"#fff\";\r\n    // this.borderThickness = 0.5;\r\n    // this.canvas = document.querySelector(\"canvas.tetris\");\r\n    // this.canvas.width = window.innerWidth;\r\n    // this.canvas.height = window.innerHeight;\r\n    // this.context = this.canvas.getContext(\"2d\");\r\n  }\r\n\r\n  // drawBorders() {\r\n  //   const boardBorder = [\r\n  //     this.boardPosX - this.borderThickness,\r\n  //     this.boardPosY + HIDDEN_ROWS * this.cellSize - this.borderThickness,\r\n  //     this.borderThickness + this.boardPosX + this.board.width * this.cellSize,\r\n  //     this.borderThickness + this.boardPosY + this.board.height * this.cellSize,\r\n  //   ];\r\n  //   this.context.beginPath();\r\n  //   this.context.lineWidth = 1;\r\n  //   this.context.moveTo(boardBorder[0], boardBorder[1]);\r\n  //   this.context.lineTo(boardBorder[2], boardBorder[1]);\r\n  //   this.context.lineTo(boardBorder[2], boardBorder[3]);\r\n  //   this.context.lineTo(boardBorder[0], boardBorder[3]);\r\n  //   this.context.closePath();\r\n  //   this.context.strokeStyle = this.borderColor;\r\n\r\n  //   this.context.stroke();\r\n  // }\r\n\r\n  // drawGrid() {\r\n  //   // horizontal lines\r\n  //   this.context.strokeStyle = this.borderColor;\r\n  //   this.context.lineWidth = 0.5;\r\n\r\n  //   const boardRight = this.boardPosX + this.cellSize * this.board.width;\r\n  //   for (let i = 3; i < this.board.height; i++) {\r\n  //     const height = this.boardPosY + i * this.cellSize;\r\n  //     this.context.beginPath();\r\n  //     this.context.moveTo(this.boardPosX, height);\r\n  //     this.context.lineTo(boardRight, height);\r\n  //     this.context.closePath();\r\n  //     this.context.stroke();\r\n  //   }\r\n\r\n  //   // vertical lines\r\n  //   this.context.strokeStyle = this.borderColor;\r\n  //   const boardBottom = this.boardPosY + this.cellSize * this.board.height;\r\n  //   for (let i = 1; i < this.board.width; i++) {\r\n  //     const height = this.boardPosX + i * this.cellSize;\r\n  //     this.context.beginPath();\r\n  //     this.context.moveTo(height, this.boardPosY + HIDDEN_ROWS * this.cellSize);\r\n  //     this.context.lineTo(height, boardBottom);\r\n  //     this.context.closePath();\r\n  //     this.context.stroke();\r\n  //   }\r\n  // }\r\n  // drawBoard() {\r\n  //   this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n  //   this.drawBorders();\r\n  //   this.drawGrid();\r\n  //   for (let i = HIDDEN_ROWS; i < this.board.height; i++) {\r\n  //     for (let j = 0; j < this.board.width; j++) {\r\n  //       if (this.board.board[i][j] != null) {\r\n  //         this.drawSquare(\r\n  //           this.boardPosX + j * this.cellSize,\r\n  //           this.boardPosY + i * this.cellSize,\r\n  //           this.board.board[i][j]\r\n  //         );\r\n  //       }\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // drawLevel(level) {\r\n  //   this.context.font = \"40px serif\";\r\n  //   this.context.fillStyle = \"#000000\";\r\n  //   this.context.fillText(`Level: ${level}`, this.levelPosX, this.levelPosY);\r\n  // }\r\n\r\n  // drawScore(score) {\r\n  //   this.context.font = \"40px serif\";\r\n  //   this.context.fillStyle = \"#000000\";\r\n  //   this.context.fillText(`Score: ${score}`, this.scorePosX, this.scorePosY);\r\n  // }\r\n\r\n  // drawPiecePreview(piece) {\r\n  //   const scoreBorder = [\r\n  //     this.previewX - this.borderThickness,\r\n  //     this.previewY - this.borderThickness,\r\n  //     this.borderThickness + this.previewX + 200,\r\n  //     this.borderThickness + this.previewY + 150,\r\n  //   ];\r\n\r\n  //   this.context.beginPath();\r\n  //   this.context.lineWidth = 1;\r\n  //   this.context.moveTo(scoreBorder[0], scoreBorder[1]);\r\n  //   this.context.lineTo(scoreBorder[2], scoreBorder[1]);\r\n  //   this.context.lineTo(scoreBorder[2], scoreBorder[3]);\r\n  //   this.context.lineTo(scoreBorder[0], scoreBorder[3]);\r\n  //   this.context.closePath();\r\n  //   this.context.strokeStyle = \"black\";\r\n  //   this.context.stroke();\r\n  //   const shape = piece.getShape();\r\n  //   for (let i = 0; i < shape.length; ++i) {\r\n  //     for (let j = 0; j < shape[i].length; ++j) {\r\n  //       if (shape[i][j] != 0) {\r\n  //         this.drawSquare(\r\n  //           this.previewX + 30 + j * this.cellSize,\r\n  //           this.previewY + 35 + i * this.cellSize,\r\n  //           piece.color\r\n  //         );\r\n  //       }\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // drawPiece(piece, posX, posY) {\r\n  //   const shape = piece.getShape();\r\n  //   for (let i = 0; i < shape.length; ++i) {\r\n  //     for (let j = 0; j < shape[i].length; ++j) {\r\n  //       if (shape[i][j] != 0) {\r\n  //         if (posY + i >= HIDDEN_ROWS) {\r\n  //           this.drawSquare(\r\n  //             this.boardPosX + (posX + j) * this.cellSize,\r\n  //             this.boardPosY + (posY + i) * this.cellSize,\r\n  //             piece.color\r\n  //           );\r\n  //         }\r\n  //       }\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  // drawSquare(x, y, color) {\r\n  //   this.context.beginPath();\r\n\r\n  //   this.context.fillStyle = color;\r\n  //   this.context.fillRect(\r\n  //     x + 0.5,\r\n  //     y + 0.5,\r\n  //     this.cellSize - 1,\r\n  //     this.cellSize - 1\r\n  //   );\r\n  // }\r\n\r\n  // drawRestart() {\r\n  //   this.context.beginPath();\r\n  //   this.context.rect(500, 500, 250, 100);\r\n  //   this.context.fillStyle = \"#000000\";\r\n  //   this.context.fillStyle = \"rgba(225,225,225,0.5)\";\r\n  //   // this.context.fillRect(25, 72, 32, 32);\r\n  //   this.context.fill();\r\n  //   this.context.lineWidth = 2;\r\n  //   this.context.strokeStyle = \"#000000\";\r\n  //   this.context.stroke();\r\n  //   this.context.closePath();\r\n  //   this.context.font = \"40pt Serif\";\r\n  //   this.context.fillStyle = \"#000000\";\r\n  //   this.context.fillText(\"Restart\", 550, 570);\r\n  // }\r\n\r\n  // drawControls() {\r\n  //   this.context.font = \"20px serif\";\r\n  //   this.context.fillStyle = \"#000000\";\r\n  //   this.context.fillText(\"Controls:\", 550, 700);\r\n  //   this.context.fillText(\"Q/E - rotate\", 550, 720);\r\n  //   this.context.fillText(\"W/D or left/right arrows - left/right\", 550, 740);\r\n  //   this.context.fillText(\"S or down arrow - speed down\", 550, 760);\r\n  // }\r\n}\r\n\r\nexport default Canvas;\r\n"],"sourceRoot":""}