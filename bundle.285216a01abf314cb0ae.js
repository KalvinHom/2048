(()=>{"use strict";const t=new class{constructor(){this.setDefaults()}setDefaults(){this.board=new class{constructor(){this.board=Array(4).fill().map((()=>Array(4).fill(0))),this.actions=Array(4).fill().map((()=>Array(4).fill().map((t=>({action:0}))))),this.canvas=document.querySelector("canvas.board"),this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.context=this.canvas.getContext("2d"),this.numTranslate=0,this.ready=!0}beginTurn(){this.ready=!1}newPiece(){let t,a;do{t=Math.floor(4*Math.random()),a=Math.floor(4*Math.random())}while(0!=this.board[a][t]);const s=Math.floor(10*Math.random());this.board[a][t]=0==s?4:2,this.actions[a][t].action=-1,console.log(`new piece at ${t}, ${a}`)}moveLeft(){let t=!1;for(let a=0;a<4;a++)for(let s=0;s<4;s++){const i=this.getNextValue(s+1,a,1);if(-1==i)break;0==this.board[a][s]?(t=!0,this.board[a][s]=this.board[a][i],this.board[a][i]=0,this.actions[a][i].action=1,this.actions[a][i].translate=[s-i,0],s--):this.board[a][s]==this.board[a][i]&&(t=!0,this.board[a][s]*=2,this.board[a][i]=0,this.actions[a][i].action=2,this.actions[a][i].translate=[s-i,0])}return t}moveRight(){let t=!1;for(let a=0;a<4;a++)for(let s=3;s>=0;s--){const i=this.getNextValue(s-1,a,-1);if(-1==i)break;0==this.board[a][s]?(t=!0,this.board[a][s]=this.board[a][i],this.board[a][i]=0,this.actions[a][i].action=1,this.actions[a][i].translate=[s-i,0],s++):this.board[a][s]==this.board[a][i]&&(t=!0,this.board[a][s]*=2,this.board[a][i]=0,this.actions[a][i].action=2,this.actions[a][i].translate=[s-i,0])}return t}moveUp(){let t=!1;for(let a=0;a<4;a++)for(let s=0;s<4;s++){const i=this.getNextYValue(a,s+1,1);if(-1==i)break;0==this.board[s][a]?(t=!0,this.board[s][a]=this.board[i][a],this.board[i][a]=0,this.actions[i][a].action=1,this.actions[i][a].translate=[0,s-i],s--):this.board[s][a]==this.board[i][a]&&(t=!0,this.board[s][a]*=2,this.board[i][a]=0,this.actions[i][a].action=2,this.actions[i][a].translate=[0,s-i])}return t}moveDown(){let t=!1;for(let a=0;a<4;a++)for(let s=3;s>=0;s--){const i=this.getNextYValue(a,s-1,-1);if(-1==i)break;0==this.board[s][a]?(t=!0,this.board[s][a]=this.board[i][a],this.board[i][a]=0,this.actions[i][a].action=1,this.actions[i][a].translate=[0,s-i],s++):this.board[s][a]==this.board[i][a]&&(t=!0,this.board[s][a]*=2,this.board[i][a]=0,this.actions[i][a].action=2,this.actions[i][a].translate=[0,s-i])}return t}getNextValue(t,a,s){for(;t>=0&&t<4;){if(0!=this.board[a][t])return t;t+=s}return-1}getNextYValue(t,a,s){for(;a>=0&&a<4;){if(0!=this.board[a][t])return a;a+=s}return-1}style(t,a){return-1==this.actions[t][a]?"new-tile":"normal"}draw(){this.context.clearRect(0,0,this.canvas.width,this.canvas.height),console.log("beginning board draw"),console.log(this.actions);var t=!1;for(let s=0;s<4;s++)for(let i=0;i<4;i++)if(0==this.board[s][i]||(this.style(s,i),this.board[s][i]),0!=this.actions[s][i].action&&-1!=this.actions[s][i].action){t=!0,document.getElementsByClassName("grid-row")[s].getElementsByClassName("grid-cell")[i].getElementsByClassName("tile")[0].style.transform=`translate(${106.25*this.actions[s][i].translate[0]+15*this.actions[s][i].translate[0]}px, ${106.25*this.actions[s][i].translate[1]+15*this.actions[s][i].translate[1]}px)`,this.numTranslate++,this.transitioning=!0,console.log(`added numTranslate:${this.numTranslate}`);var a=this;$(".normal").each((function(){this.addEventListener("transitionend",(function t(s){console.log(s.currentTarget),s.currentTarget.removeEventListener(s.type,t),a.completeTransitions()}))}))}t||(this.drawBoard(),this.ready=!0)}drawBoard(){for(let s=0;s<4;s++)for(let i=0;i<4;i++){var t=0==this.board[s][i]?"":255-10*Math.log2(this.board[s][i]),a=0==this.board[s][i]?"":`<div class="tile ${this.style(s,i)}" style="background: rgb(255, ${t}, ${t})\n            ">${this.board[s][i]}</div>`;document.getElementsByClassName("grid-row")[s].getElementsByClassName("grid-cell")[i].innerHTML=a,this.actions[s][i].action=0}}completeTransitions(){this.transitioning&&(console.log("complete transition"),this.drawBoard(),this.ready=!0,this.transitioning=!1)}},this.canvas=new class{constructor(t){}}}isReady(){return this.board.ready}startGame(){this.lastRenderTime=Date.now(),this.board.newPiece(),this.board.newPiece(),this.board.drawBoard()}moveLeft(){this.board.beginTurn(),this.board.moveLeft()&&this.board.newPiece(),this.board.draw()}moveRight(){this.board.beginTurn(),this.board.moveRight()&&this.board.newPiece(),this.board.draw()}moveUp(){this.board.beginTurn(),this.board.moveUp()&&this.board.newPiece(),this.board.draw()}moveDown(){this.board.beginTurn(),this.board.moveDown()&&this.board.newPiece(),this.board.draw()}};t.startGame();let a=!1;window.addEventListener("keydown",(function(s){if(s.preventDefault(),!a&&t.isReady()){switch(a=!0,s.key,s.preventDefault(),s.key){case"ArrowLeft":case"a":t.moveLeft();break;case"ArrowRight":case"d":t.moveRight();break;case"ArrowUp":case"w":t.moveUp();break;case"ArrowDown":case"s":t.moveDown();break;default:return void(a=!1)}a=!1}}))})();
//# sourceMappingURL=bundle.285216a01abf314cb0ae.js.map